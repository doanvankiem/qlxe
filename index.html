<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Đăng Ký</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body>
<div class="container">
  <div class="center-align">
    <h4>Tạo đơn</h4>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <select id="loai-hang" required>
          <option value="" selected>Chọn loại hàng</option>
          <option value="loai1">Hàng Tổng Hợp</option>
          <option value="loai2">Hàng Cảng</option>
        </select>
        <label>Loại Hàng</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <select id="ten-bai" required>
          <option value="" selected>Chọn tên bãi</option>
        </select>
        <label>Tên Bãi</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <select id="ma-hang" required>
          <option value="" selected>Chọn mã hàng</option>
        </select>
        <label>Mã Hàng</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="cuoc-thu-bai" type="text" readonly>
        <label for="cuoc-thu-bai">Cước Thu Bãi</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="gia-mua" type="text" readonly>
        <label for="gia-mua">Giá Mua</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="tien-cuoc" type="text" readonly>
        <label for="tien-cuoc">Tiền Cước</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="so-chuyen" type="text" readonly>
        <label for="so-chuyen">Số Chuyến</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="tai-xe" type="text" readonly>
        <label for="tai-xe">Tài Xế</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="boi-duong" type="text" readonly>
        <label for="boi-duong">Bồi Dưỡng</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="dau-tieu-thu" type="text" readonly>
        <label for="dau-tieu-thu">Dầu Tiêu Thụ</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="tien-dau" type="text" readonly>
        <label for="tien-dau">Tiền Dầu</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="dia-diem-van-chuyen" type="text" readonly>
        <label for="dia-diem-van-chuyen">Địa Điểm V/C</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <select id="thanh-toan">
          <option value="" disabled selected>Chọn phương thức thanh toán</option>
          <option value="tra-truoc">Trả trước</option>
          <option value="tra-sau">Trả sau</option>
        </select>
        <label>Thanh Toán</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <textarea id="ghi-chu" class="materialize-textarea"></textarea>
        <label for="ghi-chu">Ghi Chú</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s12">
      <div class="input-field">
        <input id="thanh-tien" type="text" readonly>
        <label for="thanh-tien">Thành Tiền</label>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col s6">
      <button id="clear-btn" class="btn red lighten-1 waves-effect waves-light" type="button">Nhập lại
        <i class="material-icons right">clear</i>
      </button>
    </div>
    <div class="col s6 right-align">
      <button id="submit-btn" class="btn waves-effect waves-light" type="button">Lưu
        <i class="material-icons right">send</i>
      </button>
    </div>
  </div>
</div>
<script>
  const spreadsheetId = '13RTGIJ4LrIKGe8YaOBJrisDqUDAiC3wAZUs-MEjqP8g';
  const apiKey = 'AIzaSyB6RdUNIvZUAo2u8EVgRcMlLNUZup4Lo3s';

  const data = [
    {
      tenBai: 'Bãi Thịnh',
      range: 'CAIDAT!$P$2:$Y$1001',
    },
    {
      tenBai: 'Anh Quỳnh',
      range: 'CAIDAT!$AL$2:$AT$1001',
    },
    {
      tenBai: 'Anh Linh',
      range: 'CAIDAT!$AV$2:$BD$1001',
    },
    {
      tenBai: 'Bãi Thắng',
      range: 'CAIDAT!$AA$2:$AJ$1001',
    },
    {
      tenBai: 'Bãi Tùng Bưởi',
      range: 'CAIDAT!$BF$2:$BO$1001',
    },
    {
      tenBai: 'Bãi Tuyến Tuyến',
      range: 'CAIDAT!$BQ$2:$BZ$1001',
    },
    {
      tenBai: 'Bãi Á Thành',
      range: 'CAIDAT!$CB$2:$CK$1001',
    },
    {
      tenBai: 'Bãi Tuyến Huê',
      range: 'CAIDAT!$CM$2:$CV$1001',
    },
    {
      tenBai: 'Bãi Phú Phong',
      range: 'CAIDAT!$CX$2:$DG$1001',
    },
    {
      tenBai: 'Bãi Hạnh Hoa',
      range: 'CAIDAT!$DI$2:$DR$1001',
    },
    {
      tenBai: 'Bãi Hùng',
      range: 'CAIDAT!$DT$2:$EC$1001',
    },
    {
      tenBai: 'Bãi Tròn',
      range: 'CAIDAT!$EE$2:$EN$1001',
    },
    {
      tenBai: 'Bãi Huế Nguyệt',
      range: 'CAIDAT!$EP$2:$EY$1001',
    },
    {
      tenBai: 'Bãi Nam',
      range: 'CAIDAT!$FA$2:$FJ$1001',
    },
    {
      tenBai: 'Bãi Bằng',
      range: 'CAIDAT!$FL$2:$FU$1001',
    },
    {
      tenBai: 'Bãi TDC',
      range: 'CAIDAT!$FW$2:$GF$1001',
    },
    {
      tenBai: 'Bãi An Lợi Phú',
      range: 'CAIDAT!$GH$2:$GQ$1001',
    },
    {
      tenBai: 'Bãi Khánh',
      range: 'CAIDAT!$GS$2:$HB$1001',
    },
    {
      tenBai: 'Bãi 1',
      range: 'CAIDAT!$HD$2:$HM$1001',
    },
    {
      tenBai: 'Bãi 2',
      range: 'CAIDAT!$HO$2:$HX$1001',
    },
    {
      tenBai: 'Bãi 3',
      range: 'CAIDAT!$HZ$2:$II$1001',
    },
    {
      tenBai: 'Bãi 4',
      range: 'CAIDAT!$IK$2:$IT$1001',
    },
    {
      tenBai: 'Bãi 5',
      range: 'CAIDAT!$IV$2:$JE$1001',
    },
    {
      tenBai: 'Bãi 6',
      range: 'CAIDAT!$JG$2:$JP$1001',
    },
  ];

  function formatCurrencyVND(amount) {
    return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
  }

  function getRange(tenBai) {
    return data.find(item => item.tenBai === tenBai).range ?? '';
  }

  function loadTenBai(loaiHang) {
    const range = loaiHang === 'loai1' ? 'CAIDAT!$H$5:$H$1000' : 'CAIDAT!$H$3:$H$4';
    $.ajax({
      url: `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`,
      method: 'GET',
      success: function(response) {
        const rows = response.values;
        if (rows && rows.length > 0) {
          rows.forEach((row) => {
            $('#ten-bai').append(`<option value="${row}">${row}</option>`);
          });
        }
        $('select').formSelect(); // Reinitialize Materialize select
      },
      error: function(err) {
        console.error('Error fetching data:', err);
      }
    });
  }

  function loadMaHang() {
    const loaiHang = $('#loai-hang').val();
    const range = loaiHang === 'loai1' ? 'CAIDAT!$B$11:$B$29' : 'CAIDAT!$B$3:$B$10';
    $.ajax({
      url: `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`,
      method: 'GET',
      success: function(response) {
        const rows = response.values;
        if (rows && rows.length > 0) {
          rows.forEach((row) => {
            $('#ma-hang').append(`<option value="${row}">${row}</option>`);
          });
        }
        $('select').formSelect(); // Reinitialize Materialize select
      },
      error: function(err) {
        console.error('Error fetching data:', err);
      }
    });
  }

  function loadData() {
    const range = getRange($('#ten-bai').val());
    $.ajax({
      url: `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`,
      method: 'GET',
      success: function(response) {
        const rows = response.values;
        if (rows && rows.length > 0) {
          rows.forEach((items, index) => {
            const selectedItem = items.find(item => item === $('#ma-hang').val());
            if (selectedItem) {
              $('#cuoc-thu-bai').val(rows[index][1]);
              $('#gia-mua').val(rows[index][2]);
              $('#tien-cuoc').val(rows[index][3]);
              $('#so-chuyen').val(rows[index][8]);
              $('#tai-xe').val(rows[index][4]);
              $('#boi-duong').val(rows[index][7]);
              $('#dau-tieu-thu').val(rows[index][5]);
              $('#tien-dau').val(rows[index][6]);
              $('#dia-diem-van-chuyen').val(rows[index][9]);
              M.updateTextFields();
            }
          });
        }
      },
      error: function(err) {
        console.error('Error fetching data:', err);
      }
    });
  }

  $(document).ready(function () {
    $('select').formSelect();

    // Load Tên Bãi based on Loại Hàng
    $('#loai-hang').change(function () {
      const loaiHang = $(this).val();
      $('#ten-bai').html('<option value="" disabled selected>Chọn tên bãi</option>'); // Reset Tên Bãi
      $('#ma-hang').html('<option value="" disabled selected>Chọn mã hàng</option>'); // Reset Mã Hàng
      if (loaiHang !== '') {
        loadTenBai(loaiHang);
      }
    });

    // Load Mã Hàng based on Tên Bãi
    $('#ten-bai').change(function () {
      $('#ma-hang').html('<option value="" disabled selected>Chọn mã hàng</option>'); // Reset Mã Hàng
      loadMaHang();
      $('select').formSelect(); // Reinitialize Materialize select
    });

    // Load remaining fields based on Mã Hàng
    $('#ma-hang').change(function () {
      loadData();
    });
  });
</script>
</body>
</html>
